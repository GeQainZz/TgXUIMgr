# 需求文档: 3x-ui Telegram 机器人

## 1. 项目概述

### 1.1 项目目标
开发一个功能全面的 Telegram 机器人，以便管理员可以通过 Telegram 移动端或桌面端，随时随地、安全便捷地管理和监控 3x-ui 面板，提升管理效率。

### 1.2 用户群体
拥有和管理一个或多个 3x-ui 面板的管理员。

## 2. 功能需求

### 2.1 认证与授权
- **连接方式**: 机器人统一通过 3x-ui 面板的 **Web API** 进行连接和操作。
- **连接配置**: 由指定管理员向机器人提供面板的连接凭证（URL、用户名、密码）。
- **凭证存储**: 安全地存储（例如，加密后存储在本地数据库）面板凭证，支持快速切换和管理多个已配置的面板。
- **用户授权**: 支持两种角色：管理员（拥有全部权限）和普通用户（仅可查询个人节点信息）。所有用户均需预先授权。

### 2.2 面板状态监控
- **服务器状态**: 提供命令查询面板所在服务器的实时状态，包括 CPU 使用率、内存占用、硬盘空间等。
- **流量统计**: 查看面板全局的流量使用情况（例如，总流量、今日已用等）。
- **面板版本**: 显示当前 3x-ui 面板的版本信息。

### 2.3 入站（Inbound）管理
- **列表与搜索**:
    - 分页查看所有入站代理列表。
    - 支持按备注、端口或协议进行搜索。
- **增删改查**:
    - **查看**: 获取指定入站的详细信息，包括流量使用、到期时间、连接URL/二维码。
    - **添加**: 通过向导模式，引导用户输入协议、端口、流量上限、到期时间等参数，创建新的入站代理。
    - **删除**: 删除指定的入站代理。
    - **修改**: 修改现有入站代理的配置（如备注、流量、时限等）。
- **快捷操作**:
    - **重置流量**: 一键重置指定入站的已用流量。
    - **续期**: 快速为指定入站代理延长有效期。
- **用户查询 (普通用户)**:
    - **节点状态查询**: 普通用户可通过输入其在入站中配置的用户名（即 `email` 字段），查询对应节点的剩余流量和到期时间。

### 2.4 自动化通知
- **到期提醒**: 在入站代理到期前（如提前3天）发送提醒。
- **面板异常**: 当无法连接到 3x-ui 面板 API 时，发送离线告警。

### 2.5 机器人交互
- **命令驱动**: 支持 `/start`, `/help`, `/status` 等标准化命令。
- **菜单导航**: 使用内联键盘（Inline Keyboard）构建清晰的、层级化的操作菜单，降低用户记忆命令的负担。
- **数据展示**: 使用格式化良好的消息（如Markdown或HTML）展示信息，清晰易读。

## 3. 技术选型
- **编程语言**: Python 3.x
- **Telegram Bot 框架**: `python-telegram-bot`
- **HTTP 客户端**: `httpx` 或 `requests` (用于调用 3x-ui API)
- **数据库**: `SQLite` (用于存储用户授权信息和面板配置)
